@using GpuMiningInsights.Web.Models
@using GpuMiningInsights.Core;
@using Newtonsoft.Json
@model List<GPU>
@{
    List<GPU> gpuDummy = Model;
    ViewBag.Title = "Home Page";
    DateTime? lastUpdate = ViewData["LastUpdate"] as DateTime?;
    if (gpuDummy == null)
    {
        gpuDummy = new List<GPU>();

        gpuDummy = JsonConvert.DeserializeObject<List<GPU>>("[{\"Name\":\"RX 570\",\"WhatToMineUrl\":\"https://whattomine.com/coins?utf8=%E2%9C%93&adapt_q_280x=0&adapt_q_380=0&adapt_q_fury=0&adapt_q_470=0&adapt_q_480=3&adapt_q_570=1&adapt_570=true&adapt_q_580=0&adapt_q_vega56=0&adapt_q_vega64=0&adapt_q_750Ti=0&adapt_q_1050Ti=0&adapt_q_10606=0&adapt_q_1070=0&adapt_q_1070Ti=0&adapt_q_1080=0&adapt_q_1080Ti=0&eth=true&factor%5Beth_hr%5D=27.9&factor%5Beth_p%5D=120.0&factor%5Bgro_hr%5D=15.5&factor%5Bgro_p%5D=110.0&factor%5Bx11g_hr%5D=5.6&factor%5Bx11g_p%5D=110.0&factor%5Bcn_hr%5D=700.0&factor%5Bcn_p%5D=110.0&factor%5Beq_hr%5D=260.0&factor%5Beq_p%5D=110.0&factor%5Blrev2_hr%5D=5500.0&factor%5Blrev2_p%5D=110.0&factor%5Bns_hr%5D=630.0&factor%5Bns_p%5D=140.0&factor%5Blbry_hr%5D=115.0&factor%5Blbry_p%5D=115.0&factor%5Bbk2b_hr%5D=840.0&factor%5Bbk2b_p%5D=115.0&factor%5Bbk14_hr%5D=1140.0&factor%5Bbk14_p%5D=115.0&factor%5Bpas_hr%5D=580.0&factor%5Bpas_p%5D=135.0&factor%5Bskh_hr%5D=16.3&factor%5Bskh_p%5D=110.0&factor%5Bn5_hr%5D=18.0&factor%5Bn5_p%5D=110.0&factor%5Bl2z_hr%5D=420.0&factor%5Bl2z_p%5D=300.0&factor%5Bcost%5D=0.1&sort=Profitability24&volume=0&revenue=24h&factor%5Bexchanges%5D%5B%5D=&factor%5Bexchanges%5D%5B%5D=abucoins&factor%5Bexchanges%5D%5B%5D=bitfinex&factor%5Bexchanges%5D%5B%5D=bittrex&factor%5Bexchanges%5D%5B%5D=binance&factor%5Bexchanges%5D%5B%5D=cryptopia&factor%5Bexchanges%5D%5B%5D=hitbtc&factor%5Bexchanges%5D%5B%5D=poloniex&factor%5Bexchanges%5D%5B%5D=yobit&dataset=&commit=Calculate\",\"PriceSources\":[{\"Name\":\"New Egg\",\"URL\":\"https://www.newegg.com/Product/Product.aspx?Item=9SIA6V661W8467&cm_re=rx_570-_-9SIA6V661W8467-_-Product\",\"Selector\":\"#landingpage-price .price-current\",\"PriceSourceItems\":[{\"Name\":\"New Egg\",\"URL\":null,\"Selector\":\"#landingpage-price .price-current\",\"Price\":587.99,\"ASIN\":null,\"PriceCurrency\":null,\"Merchant\":null}],\"RequiresJavascript\":true,\"PriceSourceAction\":null,\"PriceSourceItemIdentifier\":null},{\"Name\":\"Amazon\",\"URL\":\"https://www.newegg.com/Product/Product.aspx?Item=9SIA6V661W8467&cm_re=rx_570-_-9SIA6V661W8467-_-Product\",\"Selector\":\"#landingpage-price .price-current\",\"PriceSourceItems\":[{\"Name\":null,\"URL\":\"https://www.amazon.co.uk/Aberg-Pixels-Rechargeable-Digital-Camera/dp/B076GZ3JFC?psc=1&SubscriptionId=AKIAI6YFV4IQDUUAN6MQ&tag=saadtech-21&linkCode=xm2&camp=2025&creative=165953&creativeASIN=B076GZ3JFC\",\"Selector\":null,\"Price\":31.0,\"ASIN\":\"B076GZ3JFC\",\"PriceCurrency\":\"GBP\",\"Merchant\":null}],\"RequiresJavascript\":false,\"PriceSourceAction\":{\"Delegate\":{},\"method0\":{\"Name\":\"SearchItemLookupOperation\",\"AssemblyName\":\"GpuMiningInsights.Application.Amazon, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\",\"ClassName\":\"GpuMiningInsights.Application.Amazon.AmazonService\",\"Signature\":\"System.Collections.Generic.List`1[GpuMiningInsights.Core.PriceSourceItem] SearchItemLookupOperation(System.String)\",\"Signature2\":\"System.Collections.Generic.List`1[[GpuMiningInsights.Core.PriceSourceItem, GpuMiningInsights.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]] SearchItemLookupOperation(System.String)\",\"MemberType\":8,\"GenericArguments\":null}},\"PriceSourceItemIdentifier\":\"B076GZ3JFC\"}],\"LowestPriceSource\":{\"Name\":\"Amazon\",\"URL\":\"https://www.newegg.com/Product/Product.aspx?Item=9SIA6V661W8467&cm_re=rx_570-_-9SIA6V661W8467-_-Product\",\"Selector\":\"#landingpage-price .price-current\",\"PriceSourceItems\":[{\"Name\":null,\"URL\":\"https://www.amazon.co.uk/Aberg-Pixels-Rechargeable-Digital-Camera/dp/B076GZ3JFC?psc=1&SubscriptionId=AKIAI6YFV4IQDUUAN6MQ&tag=saadtech-21&linkCode=xm2&camp=2025&creative=165953&creativeASIN=B076GZ3JFC\",\"Selector\":null,\"Price\":31.0,\"ASIN\":\"B076GZ3JFC\",\"PriceCurrency\":\"GBP\",\"Merchant\":null}],\"RequiresJavascript\":false,\"PriceSourceAction\":{\"Delegate\":{},\"method0\":{\"Name\":\"SearchItemLookupOperation\",\"AssemblyName\":\"GpuMiningInsights.Application.Amazon, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\",\"ClassName\":\"GpuMiningInsights.Application.Amazon.AmazonService\",\"Signature\":\"System.Collections.Generic.List`1[GpuMiningInsights.Core.PriceSourceItem] SearchItemLookupOperation(System.String)\",\"Signature2\":\"System.Collections.Generic.List`1[[GpuMiningInsights.Core.PriceSourceItem, GpuMiningInsights.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]] SearchItemLookupOperation(System.String)\",\"MemberType\":8,\"GenericArguments\":null}},\"PriceSourceItemIdentifier\":\"B076GZ3JFC\"},\"LowestHashPrice\":{\"Source\":\"Amazon\",\"HashPrice\":1.1111111111111112},\"HashPricePerSourceList\":[{\"Source\":\"New Egg\",\"HashPrice\":21.074910394265235},{\"Source\":\"Amazon\",\"HashPrice\":1.1111111111111112}],\"Hashrate\":27.9,\"CoinToStudyName\":\"Ethereum(ETH)\",\"MiningProfitability\":{\"CryptoName\":\"\n              Ethereum(ETH)\n            \",\"CryptoAlgo\":\"\n              Ethash\n            \",\"Profitability24Hours\":1.71},\"RevenuePerDayUsd\":2.0,\"ProfitPerDayUsd\":1.71,\"ProfitPerYearMinusCostUsd\":593.15},{\"Name\":\"R9 380\",\"WhatToMineUrl\":\"https://whattomine.com/coins?utf8=%E2%9C%93&adapt_q_280x=0&adapt_q_380=1&adapt_380=true&adapt_q_fury=0&adapt_q_470=0&adapt_q_480=0&adapt_q_570=0&adapt_q_580=0&adapt_q_vega56=0&adapt_q_vega64=0&adapt_q_750Ti=0&adapt_q_1050Ti=0&adapt_q_10606=0&adapt_q_1070=0&adapt_q_1070Ti=0&adapt_q_1080=0&adapt_q_1080Ti=0&eth=true&factor%5Beth_hr%5D=20.2&factor%5Beth_p%5D=145.0&factor%5Bgro_hr%5D=15.5&factor%5Bgro_p%5D=130.0&factor%5Bx11g_hr%5D=2.5&factor%5Bx11g_p%5D=120.0&factor%5Bcn_hr%5D=530.0&factor%5Bcn_p%5D=120.0&factor%5Beq_hr%5D=205.0&factor%5Beq_p%5D=130.0&factor%5Blrev2_hr%5D=6400.0&factor%5Blrev2_p%5D=125.0&factor%5Bns_hr%5D=350.0&factor%5Bns_p%5D=145.0&factor%5Blbry_hr%5D=44.0&factor%5Blbry_p%5D=135.0&factor%5Bbk2b_hr%5D=760.0&factor%5Bbk2b_p%5D=150.0&factor%5Bbk14_hr%5D=1140.0&factor%5Bbk14_p%5D=155.0&factor%5Bpas_hr%5D=480.0&factor%5Bpas_p%5D=145.0&factor%5Bskh_hr%5D=9.0&factor%5Bskh_p%5D=120.0&factor%5Bn5_hr%5D=10.5&factor%5Bn5_p%5D=120.0&factor%5Bl2z_hr%5D=420.0&factor%5Bl2z_p%5D=300.0&factor%5Bcost%5D=0.1&sort=Profitability24&volume=0&revenue=24h&factor%5Bexchanges%5D%5B%5D=&factor%5Bexchanges%5D%5B%5D=abucoins&factor%5Bexchanges%5D%5B%5D=bitfinex&factor%5Bexchanges%5D%5B%5D=bittrex&factor%5Bexchanges%5D%5B%5D=binance&factor%5Bexchanges%5D%5B%5D=cryptopia&factor%5Bexchanges%5D%5B%5D=hitbtc&factor%5Bexchanges%5D%5B%5D=poloniex&factor%5Bexchanges%5D%5B%5D=yobit&dataset=Main&commit=Calculate\",\"PriceSources\":[{\"Name\":\"New Egg\",\"URL\":\"https://www.newegg.com/Product/Product.aspx?Item=9SIA85V6DW3604\",\"Selector\":\"#landingpage-price .price-current\",\"PriceSourceItems\":[{\"Name\":\"New Egg\",\"URL\":null,\"Selector\":\"#landingpage-price .price-current\",\"Price\":399.99,\"ASIN\":null,\"PriceCurrency\":null,\"Merchant\":null}],\"RequiresJavascript\":true,\"PriceSourceAction\":null,\"PriceSourceItemIdentifier\":null}],\"LowestPriceSource\":{\"Name\":\"New Egg\",\"URL\":\"https://www.newegg.com/Product/Product.aspx?Item=9SIA85V6DW3604\",\"Selector\":\"#landingpage-price .price-current\",\"PriceSourceItems\":[{\"Name\":\"New Egg\",\"URL\":null,\"Selector\":\"#landingpage-price .price-current\",\"Price\":399.99,\"ASIN\":null,\"PriceCurrency\":null,\"Merchant\":null}],\"RequiresJavascript\":true,\"PriceSourceAction\":null,\"PriceSourceItemIdentifier\":null},\"LowestHashPrice\":{\"Source\":\"New Egg\",\"HashPrice\":19.801485148514853},\"HashPricePerSourceList\":[{\"Source\":\"New Egg\",\"HashPrice\":19.801485148514853}],\"Hashrate\":20.2,\"CoinToStudyName\":\"Ethereum(ETH)\",\"MiningProfitability\":{\"CryptoName\":\"\n              Ethereum(ETH)\n            \",\"CryptoAlgo\":\"\n              Ethash\n            \",\"Profitability24Hours\":1.1},\"RevenuePerDayUsd\":1.45,\"ProfitPerDayUsd\":1.1,\"ProfitPerYearMinusCostUsd\":1.5100000000000478},{\"Name\":\"RX 480\",\"WhatToMineUrl\":\"https://whattomine.com/coins?utf8=%E2%9C%93&adapt_q_280x=0&adapt_q_380=0&adapt_q_fury=0&adapt_q_470=0&adapt_q_480=1&adapt_480=true&adapt_q_570=0&adapt_q_580=0&adapt_q_vega56=0&adapt_q_vega64=0&adapt_q_750Ti=0&adapt_q_1050Ti=0&adapt_q_10606=0&adapt_q_1070=0&adapt_q_1070Ti=0&adapt_q_1080=0&adapt_q_1080Ti=0&eth=true&factor%5Beth_hr%5D=29.5&factor%5Beth_p%5D=135.0&factor%5Bgro_hr%5D=18.0&factor%5Bgro_p%5D=130.0&factor%5Bx11g_hr%5D=6.7&factor%5Bx11g_p%5D=140.0&factor%5Bcn_hr%5D=730.0&factor%5Bcn_p%5D=110.0&factor%5Beq_hr%5D=290.0&factor%5Beq_p%5D=120.0&factor%5Blrev2_hr%5D=4900.0&factor%5Blrev2_p%5D=130.0&factor%5Bns_hr%5D=650.0&factor%5Bns_p%5D=150.0&factor%5Blbry_hr%5D=95.0&factor%5Blbry_p%5D=140.0&factor%5Bbk2b_hr%5D=990.0&factor%5Bbk2b_p%5D=150.0&factor%5Bbk14_hr%5D=1400.0&factor%5Bbk14_p%5D=150.0&factor%5Bpas_hr%5D=690.0&factor%5Bpas_p%5D=135.0&factor%5Bskh_hr%5D=18.0&factor%5Bskh_p%5D=115.0&factor%5Bn5_hr%5D=19.0&factor%5Bn5_p%5D=115.0&factor%5Bl2z_hr%5D=420.0&factor%5Bl2z_p%5D=300.0&factor%5Bcost%5D=0.1&sort=Profitability24&volume=0&revenue=24h&factor%5Bexchanges%5D%5B%5D=&factor%5Bexchanges%5D%5B%5D=abucoins&factor%5Bexchanges%5D%5B%5D=bitfinex&factor%5Bexchanges%5D%5B%5D=bittrex&factor%5Bexchanges%5D%5B%5D=binance&factor%5Bexchanges%5D%5B%5D=cryptopia&factor%5Bexchanges%5D%5B%5D=hitbtc&factor%5Bexchanges%5D%5B%5D=poloniex&factor%5Bexchanges%5D%5B%5D=yobit&dataset=Main&commit=Calculate\",\"PriceSources\":[{\"Name\":\"New Egg\",\"URL\":\"https://www.newegg.com/Product/Product.aspx?Item=9SIA6V66TC9897&cm_re=rx_480-_-9SIA6V66TC9897-_-Product\",\"Selector\":\"#landingpage-price .price-current\",\"PriceSourceItems\":[{\"Name\":\"New Egg\",\"URL\":null,\"Selector\":\"#landingpage-price .price-current\",\"Price\":733.94,\"ASIN\":null,\"PriceCurrency\":null,\"Merchant\":null}],\"RequiresJavascript\":true,\"PriceSourceAction\":null,\"PriceSourceItemIdentifier\":null}],\"LowestPriceSource\":{\"Name\":\"New Egg\",\"URL\":\"https://www.newegg.com/Product/Product.aspx?Item=9SIA6V66TC9897&cm_re=rx_480-_-9SIA6V66TC9897-_-Product\",\"Selector\":\"#landingpage-price .price-current\",\"PriceSourceItems\":[{\"Name\":\"New Egg\",\"URL\":null,\"Selector\":\"#landingpage-price .price-current\",\"Price\":733.94,\"ASIN\":null,\"PriceCurrency\":null,\"Merchant\":null}],\"RequiresJavascript\":true,\"PriceSourceAction\":null,\"PriceSourceItemIdentifier\":null},\"LowestHashPrice\":{\"Source\":\"New Egg\",\"HashPrice\":24.879322033898308},\"HashPricePerSourceList\":[{\"Source\":\"New Egg\",\"HashPrice\":24.879322033898308}],\"Hashrate\":29.5,\"CoinToStudyName\":\"Ethereum(ETH)\",\"MiningProfitability\":{\"CryptoName\":\"\n              Ethereum(ETH)\n            \",\"CryptoAlgo\":\"\n              Ethash\n            \",\"Profitability24Hours\":1.79},\"RevenuePerDayUsd\":2.11,\"ProfitPerDayUsd\":1.79,\"ProfitPerYearMinusCostUsd\":-80.590000000000032}]");

    }
}

<div class="jumbotron">
    <h1>Gpu Mining Insights</h1>
    <br />
    <p class="lead">
        Gpu Mining insights provides you with the right information for getting you numbers right , including the Current price of the gpu.
    </p>
    <p>
        Last Update : @lastUpdate &nbsp;
        @using (Html.BeginForm("Index", "Home", FormMethod.Post))
        {
            <button type="submit" class="btn btn-primary btn-lg"> Refresh</button>
        }
    </p>
</div>

<div class="row">
    <div class="col-md-12">
        <table class="table table-bordered table-striped">
            <thead>
                @*

                            System.Console.WriteLine($"GPU {gpuName} ,
                            ProfitPerYearMinusCostUsd = {item.ProfitPerYearMinusCostUsd},
                            Revenue ($/Day) = {item.RevenuePerDayUsd},
                            Profit ($/Day) = {item.ProfitPerDayUsd}  ,
                            HashRate = {item.Hashrate},
                            HashCost = {hashPrice},
                            FROM = {hashPriceSource } @ Price : {gpuPriceFromSource }");

                    ($"GPU {gpuName} HashRate = {item.Hashrate}, HashCost = {hashPrice}, FROM = {hashPriceSource } @ Price : {gpuPriceFromSource }");*@


                <tr>
                    <th>GPU</th>
                    <th>Revenue ($/Day)</th>
                    <th>Profit ($/Day)</th>
                    <th>Profit(Minus GPU Cost Usd)/Year </th>
                    <th>Hashrate</th>
                    <th>HashCost (Price Source)</th>
                    <th>Price</th>
                    <th>Revenue</th>
                    <th>ROI</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < gpuDummy.Count; i++)
                {
                    GPU gpu = gpuDummy[i];
                    int index = i;
                    string hashPrice = gpu.LowestHashPrice.HashPrice.ToString();
                    string hashPriceSource = xgpu.LowestHashPrice.Source;
                    string gpuPriceFromSource = gpu.PriceSources.FirstOrDefault(s => s.Name == hashPriceSource).PriceSourceItems.Min(a => a.Price).ToString();
                    double annualRevenue = gpu.ProfitPerDayUsd * 365;
                    double roi = (annualRevenue - gpu.PriceSources.FirstOrDefault(s => s.Name == hashPriceSource).PriceSourceItems.Min(a => a.Price)) / gpu.PriceSources.FirstOrDefault(s => s.Name == hashPriceSource).PriceSourceItems.Min(a => a.Price);
                    string roistyle = roi >= 0 ? "" : "style=\"color:#de6c6c\"";
                    if (roi > 30)
                    {
                        roistyle = "style=\"color:#0fc304\"";
                    }
                    <tr>
                        <td>@gpu.Name</td>
                        <td>@gpu.RevenuePerDayUsd</td>
                        <td>@gpu.ProfitPerDayUsd</td>
                        <td>@gpu.ProfitPerYearMinusCostUsd</td>
                        <td>@gpu.Hashrate</td>
                        <td>@hashPrice (@hashPriceSource)</td>
                        <td>@gpuPriceFromSource</td>
                        <td>@annualRevenue </td>
                        <td @Html.Raw(roistyle)>@(Math.Round(roi * 100, 2)) %</td>
                        <td>
                            <button type="button" class="btn btn-primary" onclick="onBuyNowClick(@index)">Buy Now!</button>
                        </td>
                    </tr>
                }
            </tbody>



        </table>
        <div id="price-details-div">

        </div>
        <div class="hidden">
            @for (int i = 0; i < gpuDummy.Count; i++)
            {
                GPU gpu = gpuDummy[i];
                <table id="gpuprices-@i">
                    <thead>
                        <tr>
                            <th>GPU</th>
                            <th>Price</th>
                            <th>From</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var priceSource in gpu.PriceSources)
                        {
                            foreach (var priceSourceItem in priceSource.PriceSourceItems)
                            {
                                <tr>
                                    <td>
                                        <a href="@priceSourceItem.URL">@gpu.Name</a>
                                    </td>
                                    <td>@priceSourceItem.Price </td>
                                    <td>@priceSource.Name </td>
                                    <td>
                                        <a href="@priceSourceItem.URL" class="btn btn-primary">Buy Now!</a>
                                    </td>
                                </tr>
                            }
                        }

                    </tbody>
                </table>
            }
        </div>

    </div>

</div>


@section scripts
{
    <script>
        function onBuyNowClick(i) {
            $('#price-details-div').html($('#gpuprices-' + i).html());
        }
    </script>

}
